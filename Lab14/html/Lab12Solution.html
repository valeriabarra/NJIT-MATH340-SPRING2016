
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Lab 12 Solution</title><meta name="generator" content="MATLAB 8.5"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2015-04-24"><meta name="DC.source" content="Lab12Solution.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Lab 12 Solution</h1><!--introduction--><p>Lab Instructor: Valeria Barra</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">Problem 1: Implicit Euler Method</a></li><li><a href="#5">Problem 2: Explicit Euler for System of ODEs</a></li><li><a href="#8">Extra Credit: R-K4 for the System of ODEs</a></li></ul></div><p>Friday Lab 04-24-2015, DUE Tuesday 04-28-2015 ; Monday Lab 04-27-2015, DUE Thursday 04-30-2015</p><h2>Problem 1: Implicit Euler Method<a name="2"></a></h2><p>Implement your own Implicit (backward) Euler's method to solve the IVP y'=2*y, y(0)=1. Reproduce the three tables for <img src="Lab12Solution_eq07226894199989526750.png" alt="$h=0.2,0.1,0.05$">, showing the grid points <img src="Lab12Solution_eq14450145758366837506.png" alt="$t_i$">, approximated solution <img src="Lab12Solution_eq11174449752623653570.png" alt="$w_i$">, the actual solution <img src="Lab12Solution_eq08366435799313302571.png" alt="$y_i$"> and the error <img src="Lab12Solution_eq16537821098686504121.png" alt="$e_i$">, all at the same grid points <img src="Lab12Solution_eq12666374333687270468.png" alt="$t_i = 0, 0.2, 0.4, 0.6, 0.8, 1.0$"> for all three tables. To compute the error at each grid point <img src="Lab12Solution_eq11275726639961136444.png" alt="$e_i= |y(t_i) - w_i|$"> use the value for the actual solution given <img src="Lab12Solution_eq04453727003757653977.png" alt="$y(t) = 3 e ^{{t^2}/2} - t^2 - 2$">.</p><p><b>Solution:</b></p><pre class="codeinput">clear <span class="string">all</span>; close <span class="string">all</span>;
<span class="comment">% function handle of the RHS function for the problem</span>
f=@(t,y)(-2.*y);
<span class="comment">% the actual solution</span>
y=@(t)( exp(-2.*t));
<span class="comment">% the vector of all h's</span>
h=2.^(0:-1:-4);

<span class="comment">% the IC given</span>
w0=1;

Markers = [<span class="string">'o'</span> <span class="string">'^'</span> <span class="string">'s'</span> <span class="string">'&gt;'</span> <span class="string">'&lt;'</span>]; <span class="comment">% just different symbols to plot</span>
Colors = [<span class="string">'r'</span> <span class="string">'g'</span> <span class="string">'b'</span> <span class="string">'c'</span> <span class="string">'m'</span>]; <span class="comment">% different colors used for the different markers</span>

<span class="comment">% the main cycle of the call of the function and display starts here</span>
    <span class="comment">% print the header of the table</span>
    fprintf(<span class="string">'\nProblem 1\n'</span>)
    fprintf(<span class="string">'______________________________________________\n\n'</span>)
    fprintf(<span class="string">'h             w_i         Error          Ratio   \n'</span>)
    fprintf(<span class="string">'______________________________________________\n'</span>)
<span class="keyword">for</span> j=1:length(h)

    t{j}=(0:h(j):2); <span class="comment">% domain</span>

    <span class="comment">% the implicit method here:</span>
     w{j} =ImplicitEulerForLab12(t{j}, w0,h(j));

    Error(j)=abs(y(t{j}(end)) - w{j}(end));
        <span class="comment">% print the table</span>

    <span class="keyword">if</span> j==1
        fprintf(<span class="string">'%5.4f     %7.4f      %8.4e  \n'</span>,h(j), w{j}(end) , Error(j))
    <span class="keyword">else</span>
        Ratio(j-1)=Error(j-1)/Error(j);
        fprintf(<span class="string">'%5.4f     %7.4f      %8.4e     %7.4f \n'</span>,h(j),w{j}(end)  ,Error(j), Ratio(j-1))
    <span class="keyword">end</span>


    <span class="comment">% plots of all the approximations here</span>
    line_fewer_markers(t{j},w{j},2*j,Markers(j),<span class="string">'MarkerFaceColor'</span>,Colors(j),<span class="string">'MarkerSize'</span>,5);
    hold <span class="string">on</span>
    <span class="comment">% plotting here</span>
    <span class="keyword">if</span> j==length(h)
        plot(t{j},y(t{j}),<span class="string">'--r'</span>) <span class="comment">% plots the real solution only the last time</span>
        hold <span class="string">on</span>
    <span class="keyword">end</span>

<span class="keyword">end</span>
fprintf(<span class="string">'______________________________________________\n'</span>)

<span class="comment">% attributes of the figure here</span>
title(<span class="string">'Problem 1'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'w'</span>)
box <span class="string">on</span>
legend({<span class="string">'$w_{h=1}$'</span>,<span class="string">'$w_{h=1/2}$'</span>,<span class="string">'$w_{h=1/4}$'</span>,<span class="string">'$w_{h=1/8}$'</span>,<span class="string">'$w_{h=1/16}$'</span>,<span class="string">'y'</span>},<span class="string">'interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'location'</span>,<span class="string">'northwest'</span>);
</pre><pre class="codeoutput">
Problem 1
______________________________________________

h             w_i         Error          Ratio   
______________________________________________
1.0000      0.1111      9.2795e-02  
0.5000      0.0625      4.4184e-02      2.1002 
0.2500      0.0390      2.0703e-02      2.1342 
0.1250      0.0281      9.8319e-03      2.1057 
0.0625      0.0231      4.7582e-03      2.0663 
______________________________________________
</pre><img vspace="5" hspace="5" src="Lab12Solution_01.png" alt=""> <p><b>Comments on Results:</b> Implicit (backward) Euler's scheme is still of first order. And you can see that the ratio between two consecutive errors is roughly 2, as h was halved. The advantage of using an Implicit scheme rather than an Explicit one stands in the fact that the approximated solution is less sensitive to variations of the step size h. The explicit method needs to satisfy stability condition on the step size (this should be sufficiently small) to have reliable results. While the Implicit method is unconditionally stable (the reliability of the method does not depend on the step size chosen).</p><h2>Problem 2: Explicit Euler for System of ODEs<a name="5"></a></h2><p>Use Explicit (forward) Euler to solve the following system of ODEs</p><p><b>Solution:</b></p><pre class="codeinput"><span class="comment">% function handles of RHS functions</span>
f1=@(t,u1,u2)(9*u1 + 24*u2 + 5*cos(t) - (1/3)*sin(t));
f2=@(t,u1,u2)(-24*u1 - 51*u2 - 9*cos(t) + (1/3)*sin(t));

<span class="comment">% ICs</span>
u0_1=4/3; u0_2=2/3;

<span class="comment">% the vector of all h's</span>
h=2.^(0:-1:-9);

<span class="comment">% actual solutions</span>
U1=@(t)(2*exp(-3.*t) -exp(-39.*t) + (1/3)*cos(t));
U2=@(t)(- exp(-3*t) + 2*exp(-39.*t) - (1/3)*cos(t));
<span class="comment">% print the header of the table</span>
fprintf(<span class="string">'\nProblem 2: Explicit Euler\n'</span>)
fprintf(<span class="string">'____________________________Values for t=1________________________________\n\n'</span>)
fprintf(<span class="string">'__________________________________________________________________________\n'</span>)
fprintf(<span class="string">'h              w1               w2             Error_1           Error_2    \n'</span>)
fprintf(<span class="string">'__________________________________________________________________________\n'</span>)
<span class="keyword">for</span> j=1:length(h)


    t{j}=(0:h(j):1); <span class="comment">% domain</span>
    <span class="comment">% the call of the method</span>

    [w1{j},w2{j}]=ExplicitEulerSystem(f1,f2, t{j},u0_1,u0_2,h(j));

     <span class="comment">% corresponding errors</span>
    ExpError1(j)=abs(U1(t{j}(end)) - w1{j}(end));
    ExpError2(j)=abs(U2(t{j}(end)) - w2{j}(end));

    <span class="comment">% print the table</span>
    fprintf(<span class="string">'%6.4f     % 9.4e      % 9.4e      % 9.4e      % 9.4e \n'</span>,h(j), w1{j}(end) ,w2{j}(end),ExpError1(j),ExpError2(j));
<span class="keyword">end</span>
fprintf(<span class="string">'___________________________________________________________________________\n'</span>)
</pre><pre class="codeoutput">
Problem 2: Explicit Euler
____________________________Values for t=1________________________________

__________________________________________________________________________
h              w1               w2             Error_1           Error_2    
__________________________________________________________________________
1.0000      3.4333e+01      -7.4333e+01       3.4054e+01       7.4103e+01 
0.5000     -3.4180e+02       6.8455e+02       3.4208e+02       6.8478e+02 
0.2500     -5.8637e+03       1.1728e+04       5.8640e+03       1.1728e+04 
0.1250     -5.0845e+04       1.0169e+05       5.0845e+04       1.0169e+05 
0.0625     -3.3223e+02       6.6474e+02       3.3250e+02       6.6497e+02 
0.0313      2.6663e-01      -2.2340e-01       1.3044e-02       6.4853e-03 
0.0156      2.7312e-01      -2.2663e-01       6.5568e-03       3.2598e-03 
0.0078      2.7639e-01      -2.2825e-01       3.2863e-03       1.6338e-03 
0.0039      2.7803e-01      -2.2907e-01       1.6450e-03       8.1782e-04 
0.0020      2.7885e-01      -2.2948e-01       8.2296e-04       4.0914e-04 
___________________________________________________________________________
</pre><p><b>Comments on Results:</b> As we have already seen by using Euler's Explicit Method for one single ODE, the order of convergence is linear in h. In fact, as h is halved, the error is also roughly halved.</p><h2>Extra Credit: R-K4 for the System of ODEs<a name="8"></a></h2><p>Solve the same system above with Runge-Kutta 4 method for systems of ODEs.</p><p><b>Solution:</b></p><pre class="codeinput"><span class="comment">% print the header of the table</span>
fprintf(<span class="string">'\nProblem 2: R-K4\n'</span>)
fprintf(<span class="string">'____________________________Values for t=1________________________________\n\n'</span>)
fprintf(<span class="string">'__________________________________________________________________________\n'</span>)
fprintf(<span class="string">'h              w1               w2             Error_1           Error_2    \n'</span>)
fprintf(<span class="string">'__________________________________________________________________________\n'</span>)
<span class="keyword">for</span> j=1:length(h)


    t{j}=(0:h(j):1); <span class="comment">% domain</span>
    <span class="comment">% the call of the method</span>

    [w1{j},w2{j}]=RK4System(f1,f2, t{j},u0_1,u0_2,h(j));

     <span class="comment">% corresponding errors</span>
    ExpError1(j)=abs(U1(t{j}(end)) - w1{j}(end));
    ExpError2(j)=abs(U2(t{j}(end)) - w2{j}(end));

    <span class="comment">% print the table</span>
    fprintf(<span class="string">'%6.4f     % 9.4e      % 9.4e      % 9.4e      % 9.4e \n'</span>,h(j), w1{j}(end) ,w2{j}(end),ExpError1(j),ExpError2(j));
<span class="keyword">end</span>
fprintf(<span class="string">'___________________________________________________________________________\n'</span>)
</pre><pre class="codeoutput">
Problem 2: R-K4
____________________________Values for t=1________________________________

__________________________________________________________________________
h              w1               w2             Error_1           Error_2    
__________________________________________________________________________
1.0000     -8.7294e+04       1.7459e+05       8.7294e+04       1.7459e+05 
0.5000     -2.4616e+07       4.9232e+07       2.4616e+07       4.9232e+07 
0.2500     -4.6304e+09       9.2608e+09       4.6304e+09       9.2608e+09 
0.1250     -5.0119e+08       1.0024e+09       5.0119e+08       1.0024e+09 
0.0625      2.7936e-01      -2.2925e-01       3.1697e-04       6.3901e-04 
0.0313      2.7967e-01      -2.2988e-01       1.4951e-06       3.2828e-06 
0.0156      2.7967e-01      -2.2989e-01       6.6783e-08       1.5113e-07 
0.0078      2.7967e-01      -2.2989e-01       3.5180e-09       8.1125e-09 
0.0039      2.7967e-01      -2.2989e-01       2.0107e-10       4.6874e-10 
0.0020      2.7967e-01      -2.2989e-01       1.2002e-11       2.8148e-11 
___________________________________________________________________________
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2015a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Lab 12 Solution
% Lab Instructor: Valeria Barra
%%
% Friday Lab 04-24-2015, DUE Tuesday 04-28-2015 ;
% Monday Lab 04-27-2015, DUE Thursday 04-30-2015

%% Problem 1: Implicit Euler Method
% Implement your own Implicit (backward) Euler's method to solve the IVP y'=2*y, y(0)=1. Reproduce the three tables for $h=0.2,0.1,0.05$, showing the grid points $t_i$, approximated solution $w_i$, the actual solution $y_i$ and the error $e_i$, all at the same grid points $t_i = 0, 0.2, 0.4, 0.6, 0.8, 1.0$ for all three tables. To compute the error at each grid point $e_i= |y(t_i) - w_i|$ use the value for the actual solution given $y(t) = 3 e ^{{t^2}/2} - t^2 - 2$.

%%
% *Solution:*

clear all; close all;
% function handle of the RHS function for the problem
f=@(t,y)(-2.*y);
% the actual solution
y=@(t)( exp(-2.*t));
% the vector of all h's
h=2.^(0:-1:-4);

% the IC given
w0=1;

Markers = ['o' '^' 's' '>' '<']; % just different symbols to plot
Colors = ['r' 'g' 'b' 'c' 'm']; % different colors used for the different markers

% the main cycle of the call of the function and display starts here
    % print the header of the table
    fprintf('\nProblem 1\n')
    fprintf('______________________________________________\n\n')
    fprintf('h             w_i         Error          Ratio   \n')
    fprintf('______________________________________________\n')
for j=1:length(h)

    t{j}=(0:h(j):2); % domain 
    
    % the implicit method here:
     w{j} =ImplicitEulerForLab12(t{j}, w0,h(j));

    Error(j)=abs(y(t{j}(end)) - w{j}(end));
        % print the table
        
    if j==1 
        fprintf('%5.4f     %7.4f      %8.4e  \n',h(j), w{j}(end) , Error(j))
    else
        Ratio(j-1)=Error(j-1)/Error(j);
        fprintf('%5.4f     %7.4f      %8.4e     %7.4f \n',h(j),w{j}(end)  ,Error(j), Ratio(j-1))
    end

   
    % plots of all the approximations here
    line_fewer_markers(t{j},w{j},2*j,Markers(j),'MarkerFaceColor',Colors(j),'MarkerSize',5);
    hold on
    % plotting here
    if j==length(h)
        plot(t{j},y(t{j}),'REPLACE_WITH_DASH_DASHr') % plots the real solution only the last time
        hold on
    end

end
fprintf('______________________________________________\n')

% attributes of the figure here
title('Problem 1')
xlabel('t')
ylabel('w')
box on
legend({'$w_{h=1}$','$w_{h=1/2}$','$w_{h=1/4}$','$w_{h=1/8}$','$w_{h=1/16}$','y'},'interpreter','latex','location','northwest');

%%
% *Comments on Results:*
% Implicit (backward) Euler's scheme is still of first order. And you can see
% that the ratio between two consecutive
% errors is roughly 2, as h was halved. The advantage of using an Implicit
% scheme rather than an Explicit one stands in the fact that the
% approximated solution is less sensitive to variations of the step size h.
% The explicit method needs to satisfy stability condition on the step
% size (this should be sufficiently small) to have reliable results. While
% the Implicit method is unconditionally stable (the reliability of the
% method does not depend on the step size chosen).


%% Problem 2: Explicit Euler for System of ODEs
% Use Explicit (forward) Euler to solve the following system of ODEs
%%
% *Solution:*

% function handles of RHS functions
f1=@(t,u1,u2)(9*u1 + 24*u2 + 5*cos(t) - (1/3)*sin(t));
f2=@(t,u1,u2)(-24*u1 - 51*u2 - 9*cos(t) + (1/3)*sin(t));

% ICs
u0_1=4/3; u0_2=2/3;

% the vector of all h's
h=2.^(0:-1:-9);

% actual solutions 
U1=@(t)(2*exp(-3.*t) -exp(-39.*t) + (1/3)*cos(t));
U2=@(t)(- exp(-3*t) + 2*exp(-39.*t) - (1/3)*cos(t));
% print the header of the table
fprintf('\nProblem 2: Explicit Euler\n')
fprintf('____________________________Values for t=1________________________________\n\n')    
fprintf('__________________________________________________________________________\n')
fprintf('h              w1               w2             Error_1           Error_2    \n')
fprintf('__________________________________________________________________________\n')
for j=1:length(h)


    t{j}=(0:h(j):1); % domain 
    % the call of the method
    
    [w1{j},w2{j}]=ExplicitEulerSystem(f1,f2, t{j},u0_1,u0_2,h(j));

     % corresponding errors
    ExpError1(j)=abs(U1(t{j}(end)) - w1{j}(end));
    ExpError2(j)=abs(U2(t{j}(end)) - w2{j}(end));

    % print the table 
    fprintf('%6.4f     % 9.4e      % 9.4e      % 9.4e      % 9.4e \n',h(j), w1{j}(end) ,w2{j}(end),ExpError1(j),ExpError2(j));
end
fprintf('___________________________________________________________________________\n')
%%
% *Comments on Results:*
% As we have already seen by using Euler's Explicit Method for one single
% ODE, the order of convergence is linear in h. In fact, as h is halved,
% the error is also roughly halved.


%% Extra Credit: R-K4 for the System of ODEs
% Solve the same system above with Runge-Kutta 4 method for systems of
% ODEs.
%%
% *Solution:*

% print the header of the table
fprintf('\nProblem 2: R-K4\n')
fprintf('____________________________Values for t=1________________________________\n\n')    
fprintf('__________________________________________________________________________\n')
fprintf('h              w1               w2             Error_1           Error_2    \n')
fprintf('__________________________________________________________________________\n')
for j=1:length(h)


    t{j}=(0:h(j):1); % domain 
    % the call of the method
    
    [w1{j},w2{j}]=RK4System(f1,f2, t{j},u0_1,u0_2,h(j));

     % corresponding errors
    ExpError1(j)=abs(U1(t{j}(end)) - w1{j}(end));
    ExpError2(j)=abs(U2(t{j}(end)) - w2{j}(end));

    % print the table 
    fprintf('%6.4f     % 9.4e      % 9.4e      % 9.4e      % 9.4e \n',h(j), w1{j}(end) ,w2{j}(end),ExpError1(j),ExpError2(j));
end
fprintf('___________________________________________________________________________\n')


##### SOURCE END #####
--></body></html>